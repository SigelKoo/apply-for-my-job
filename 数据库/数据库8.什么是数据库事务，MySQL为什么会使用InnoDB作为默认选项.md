# 什么是数据库事务，MySQL为什么会使用InnoDB作为默认选项

### 数据库事务

数据库事务是构成单一逻辑工作单元的操作集合

```sql
BEGIN TRANSACTION  //事务开始
SQL1
SQL2
COMMIT/ROLLBACK   //事务提交或回滚
```

事务定义包括：

1. 数据库事务可以包含一个或多个数据库操作，但这些操作构成一个逻辑上的整体
2. 构成逻辑整体的这些数据库操作，要么全部执行成功，要么全部不执行
3. 构成事务的所有操作，要么全都对数据库产生影响，要么全都不产生影响，即不管事务是否执行成功，数据库总能保持一致性状态
4. 以上即使在数据库出现故障以及并发事务存在的情况下依然成立

当一个事务被提交给了DBMS（数据库管理系统），则DBMS需要确保该事务中的所有操作都成功完成且其结果被永久保存在数据库中，如果事务中有的操作没有成功完成，则事务中的所有操作都需要被回滚，回到事务执行前的状态（要么全执行，要么全都不执行）；同时，该事务对数据库或者其他事务的执行无影响，所有的事务都好像在独立的运行。

但在现实情况下，失败的风险很高。在一个数据库事务的执行过程中，有可能会遇上事务操作失败、数据库系统/操作系统失败，甚至是存储介质失败等情况。这便需要DBMS对一个执行失败的事务执行恢复操作，将其数据库状态恢复到一致状态（数据的一致性得到保证的状态）。为了实现将数据库状态恢复到一致状态的功能，DBMS通常需要维护事务日志以追踪事务中所有影响数据库数据的操作。

### MySQL为什么会使用InnoDB作为默认选项

##### InnoDB与主流的MyISAM的对比

- InnoDB支持ACID的事务4个特性，而MyISAM不支持；

- InnoDB支持4种事务隔离级别，默认是可重复读repeatable read，MyISAM不支持；

- InnoDB支持crash安全恢复，MyISAM不支持；InnoDB支持外键，MyISAM不支持；

- InnoDB支持行级别的锁粒度，MyISAM不支持，只支持表级别的锁粒度；

- InnoDB支持MVCC，MyISAM不支持。

InnoDB特性上，InnoDB表最大可以64TB，支持聚簇索引、支持压缩数据存储，支持数据加密，支持查询/索引/数据高速缓存，支持自适应hash索引、空间索引，支持热备份和恢复等。

##### 性能对比

（1）读写混合模式下，随着CPU核数的增加，InnoDB的读写能力呈线性增长，在这个测试用例里，最高可达近9000的TPS，但MyISAM因为读写不能并发，它的处理能力跟核数没关系，呈一条水平线，TPS低于500。

（2）只读模式下，随着CPU核数的增加，InnoDB的读写能力呈线性增长，最高可达近14000的TPS，但MyISAM的处理能力不到3000。

