# 聚簇索引和非聚簇索引有什么区别？什么情况用聚集索引？

聚簇索引和非聚簇索引的区别取决于数据与索引是否存放在一起

innodb只能有一个聚簇索引，向innodb插入数据时必须要包含一个索引的key值，若建表时没有索引，可以是主键->唯一键->自生成的6字节的rowid。多个聚簇索引数据要存放多份，10个聚簇索引要存十份，空间冗余，可以存在很多非聚簇索引。

myisam是非聚簇索引。

MySQL表中有几个索引？至少一个

回表

索引覆盖

最左匹配

索引下推



如果创建索引的键是其他字段，那么在叶子节点中存储的是该记录的主键，然后再通过主键索引找到对应的记录，叫做回表。

```
一个table，四个字段id，name，age，gender，id主键，name索引列
SELECT * FROM table WHERE name = zhangsan
先根据name查询id，再根据id查询整行的记录
走了两棵B+树，这种现象叫回表
当根据普通索引查询到聚簇索引的key值之后，再根据key值在聚簇索引中获取所有行的记录
SELECT id, name FROM table WHERE name = zhangsan
根据name可以直接查询到id，name两个列的值，直接返回即可，不需要从聚簇索引中查询任何数据，此时叫做索引覆盖
SELECT * FROM table WHERE age = 5
不需要回表，age没有对应到索引值，不涉及到回表过程
```

创建表SQL语句

```sql
alter table test add index idx(name);
```

设置主键要不要自增？

id最好自增，添加时因为B+树直接向后存储，不需要调整表，磁盘效率会变高

一般两种创建索引方式，添加数据时伴随索引/导入数据后，添加索引。并发请求不高，可以伴随索引添加数据，如果并发请求高，关闭索引提升数据。

刚开始没有主键，后面建立主键，聚簇索引会改变吗？

会改变，变为主键。

