# 什么是SQL注入攻击？如何防止这类攻击？

### 简介

应用程序在向后台数据库传递SQL语句进行查询时，如果为攻击者提供了影响该查询的能力，则会引发SQL注入。攻击者通过影响传递给数据库的内容来修改SQL自身的语法和功能，并且会影响SQL所支持数据库和操作系统的功能和灵活性。SQL注入不只是一种会影响Web应用的漏洞，对于任何从不可信信息源获取输入的代码来说，如果使用了该输入来构造动态SQL语句，那么很可能就会受到攻击。

### SQL注入原理

很多Web应用程序都使用数据库来存储信息。SQL命令就是前端Web和后端数据库之间的接口，使得数据可以传递至Web应用程序，自SQL数据库开始连接至Web应用起，SQL注入就可能已经存在。很多Web站点都会利用用户输入的参数动态地生成SQL查询语句，但由于开发人员的水平和经验参差不齐，相当一部分开发人员在编写代码的时候，没有对用户的输入数据或者是页面中所携带的信息（如Cookie）进行充分的合法性检查过滤，导致了攻击者可以通过在URL、表单域，或者其他的输入域中输入自己的SQL命令，以此改变查询属性，骗过应用程序，提交一段数据库查询代码，从而可以对数据进行不受限的访问，获取敏感信息或者控制应用系统。利用SQL注入漏洞可以构成对Web服务器的直接攻击，还可能利用服务器攻击第三方的浏览网站的其他用户。

### SQL注入过程

##### 第一步：判断Web环境是否可以SQL注入。

如果URL仅是对网页的访问，则不存在SQL注入问题，如：news.xxx.com/12345.html 就是普通的网页访问。只有对数据库进行动态查询的业务才可能存在SQL注入，如：music.baidu.com/search?key=11，其中? key=11表示数据库查询变量，这种语句会在数据库中执行，因此可能会给数据库带来威胁。

##### 第二步：寻找SQL注入点。

完成上一步的判断后，就要寻找可利用的注入漏洞，通过输入一些特殊语句，根据浏览器返回的信息，判断是否存在注入点以及获取数据库类型等有用信息

一般来说，SQL注入通常存在于形如：a.b.c.d/abc.asp?id=XX 等带有参数的动态网页中，有时一个动态网页中可能只有一个参数，有时可能有两个或者多个参数，有时是整型参数，有时是字符串型参数，不能一概而论。总之只要是带有参数的动态网页且此网页访问了数据库，那么就有可能存在SQL注入。如果程序员没有安全意识，不进行必要的字符过滤，存在SQL注入的可能性就非常大。

为了更形象的说明问题，以下以 example.com/abc.asp?ID=YY为例进行分析，我们假定此处的YY参数为整型。此时，通常abc.asp中SQL语句原貌大致如下：

select * from 表名 where 字段=YY。所以可以用以下步骤测试是否存在SQL注入漏洞：

1. 访问 example.com/abc.asp?ID=YY’（参数中附加了一个单引号），此时abc.asp中的SQL语句变成了select * from 表名 where 字段=YY’，abc.asp页面运行异常；

2. 访问 example.com/abc.asp?ID=YY and 1=1，abc.asp页面运行正常，而且与example.com/abc.asp?p=YY请求运行结果相同；

3. 访问 example.com/abc.asp?p=YY and 1=2，abc.asp页面运行异常；

如果以上三条全部满足，则abc.asp页面中一定存在SQL注入漏洞。

##### 第三步：猜解用户名和密码。

数据库中存放的表名、字段名都是有规律可言的，例如MySQL数据库中系统自带的information_schema信息数据库中保存着关于MySQL服务器所维护的所有其他数据库的信息，当前MySQL实例中所有数据库的信息存放在SCHEMATA表，所有表信息存放在TABLES表中，所有表中列信息存放在COLUMNS表中。攻击者可以通过构建特殊数据库语句在数据库中依次查找表名、字段名、用户名和密码的长度，以及内容。这个猜测过程可以通过网上现成的大量注入工具快速实现，并借助破解网站破译用户密码。

##### 第四步：寻找WEB管理后台入口。

通常WEB后台管理的界面不面向普通用户开放，要寻找到后台的登录路径，可以利用扫描工具快速搜索到可能的登录地址，利用社会工程学依次进行尝试，就可以试出管理台的入口地址。

##### 第五步：入侵和破坏。

成功登录后台管理后，接下来就可以任意进行破坏行为，如篡改网页、上传木马、修改、泄漏用户信息，进一步入侵数据库服务器或者获得服务器控制权限。

### 防止SQL注入攻击

前端过滤，输入框中过滤特殊字符，或者限制输入的字符集合

代码层手动过滤，同上

利用连接池组件过滤

使用预编译

使用存储过程，只传入参数



