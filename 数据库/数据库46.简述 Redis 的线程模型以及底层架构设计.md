# 简述 Redis 的线程模型以及底层架构设计

- 单线程

- 非阻塞：多个用户可以进行请求访问我们的服务器，服务器会按某种算法进行依次给予响应。在高并发情况下，这种效率较好，性能好。
- IO多路复用器：只进行接收用户的请求，而不做具体的操作实现，接受请求后交给后续的控制器进行处理。多路复用器就是使用的同步非阻塞的多对一模式，因此它的的性能效率很高。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210416204230143.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JleW9uZF9Ob3RoaW5n,size_16,color_FFFFFF,t_70)

#### 单线程原因

因为Redis是基于内存的操作，CPU不是Redis的瓶颈，Redis的瓶颈最有可能是机器内存的大小或者网络带宽。既然单线程容易实现，而且CPU不会成为瓶颈，那就顺理成章地采用单线程的方案了。

- 不需要各种锁的性能消耗

  Redis的数据结构并不全是简单的Key-Value，还有list，hash等复杂的结构，这些结构有可能会进行很细粒度的操作。

  比如在很长的列表后面添加一个元素，在hash当中添加或者删除一个对象。这些操作可能就需要加非常多的锁，导致的结果是同步开销大大增加。

  总之，在单线程的情况下，就不用去考虑各种锁的问题，不存在加锁释放锁操作，没有因为可能出现死锁而导致的性能消耗。

- 单线程多进程集群方案

  单线程的威力实际上非常强大，每核心效率也非常高，多线程自然是可以比单线程有更高的性能上限，但是在今天的计算环境中，即使是单机多线程的上限也往往不能满足需要了。

  需要进一步摸索的是多服务器集群化的方案，这些方案中多线程的技术照样是用不上的。

  所以单线程、多进程的集群不失为一个时髦的解决方案。

- CPU消耗

  采用单线程，避免了不必要的上下文切换和竞争条件，也不存在多进程或者多线程导致的切换而消耗CPU。

  但是如果CPU成为Redis瓶颈，或者不想让服务器其他CUP核闲置，那怎么办？

  可以考虑多起几个Redis进程，Redis是key-value数据库，不是关系数据库，数据之间没有约束。只要客户端分清哪些key放在哪个Redis进程上就可以了。


#### Redis单线程的优劣势

1. 单进程单线程优势
   1. 代码更清晰，处理逻辑更简单
   2.  不用去考虑各种锁的问题，不存在加锁释放锁操作，没有因为可能出现死锁而导致的性能消耗
   3.  不存在多进程或者多线程导致的切换而消耗CPU

2. 单进程单线程弊端
   1. 无法发挥多核CPU性能，不过可以通过在单机开多个Redis实例来完善