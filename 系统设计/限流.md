### 漏斗算法

#### 原理

漏斗算法的原理也很容易理解。请求来了之后会首先进到漏斗里，然后漏斗以恒定的速率将请求流出进行处理，从而起到平滑流量的作用。当请求的流量过大时，漏斗达到最大容量时会溢出，此时请求被丢弃。从系统的角度来看，我们不知道什么时候会有请求来，也不知道请求会以多大的速率来，这就给系统的安全性埋下了隐患。但是如果加了一层漏斗算法限流之后，就能够保证请求以恒定的速率流出。在系统看来，请求永远是以平滑的传输速率过来，从而起到了保护系统的作用。

![漏斗算法原理图](https:////p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/234fd84dbcec4539828f5b09b34f79bf~tplv-k3u1fbpfcp-watermark.awebp)

### 令牌桶算法

#### 原理

令牌桶算法是对漏斗算法的一种改进，除了能够起到限流的作用外，还允许一定程度的流量突发。在令牌桶算法中，存在一个令牌桶，算法中存在一种机制以恒定的速率向令牌桶中放入令牌。令牌桶也有一定的容量，如果满了令牌就无法放进去了。当请求来时，会首先到令牌桶中去拿令牌，如果拿到了令牌，则该请求会被处理，并消耗掉拿到的令牌；如果令牌桶为空，则该请求会被丢弃。

![令牌桶算法原理图](https:////p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e88b68df5bfe43b6a04ccb881028b858~tplv-k3u1fbpfcp-watermark.awebp)

