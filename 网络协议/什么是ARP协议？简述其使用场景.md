# 什么是 ARP 协议？简述其使用场景

ARP（Address Resolution Protocol）地址解析协议，通过解析网络层IP地址来寻数据链路层MAC地址的网络传输协议。

MAC（Media Access Control Address），直译为媒体存取控制位址，也称为局域网地址（LAN Address），以太网地址（Ethernet Address）或物理地址（Physical Address），它是一个用来确认网络设备位置的地址。

#### ARP 的基本功能

在实际网络的链路上传送数据帧时，最终必须使用MAC地址。

ARP协议完成主机或路由器IP地址到MAC地址的映射。（解决了下一跳走哪里）

#### ARP使用过程

检查ARP高速缓存，有对应表则写入MAC帧，没有则用目的MAC地址FF-FF-FF-FF-FF-FF的帧封装并广播ARP请求分组，同一局域网中的所有主机都能收到该请求。目的主机收到请求后就会向源主机单播一个ARP响应分组，源主机收到后将此映射写入ARP缓存（10-20min更新一次）

#### ARP四种典型情况

1. 主机A发给本网络中上的主机B：用ARP找到主机B的硬件地址；
2. 主机A发给另一网络中的主机B：用ARP找到本网络上的一个路由器（网关）的硬件地址；
3. 路由器发给本网络的主机A：用ARP找到主机A的硬件地址；
4. 路由器发给另一网络的主机B：用ARP找到本网络上的一个路由器的硬件地址。

```
主机1——集线器——交换机——路由器——路由器——交换机——主机5
            /     \                    \
          主机2   主机3                  主机4
```

主机1发给主机3：

​	应用层：文件

​	传输层：报文段1，报文段2，报文段3

​	网络层：报文段1 IP1 IP3

​	数据链路层：报文段1 IP1 IP3 MAC1 （不知道IP3的MAC地址MAC3）

​	广播ARP请求分组：IP1 IP3 MAC1 FF-FF-FF-FF-FF-FF

​	单播ARP响应分组：IP3 MAC3

​	数据链路层：FCS 报文段1 IP1 IP3 MAC1 MAC3

​	物理层：模拟/数字信号

```
                 MAC6   MAC7   
                   \     /
主机1——集线器——交换机——路由器——路由器——交换机——主机5
            /     \       /     \      \
          主机2   主机3   MAC8   MAC9    主机4
```

路由器有多个端口，有多个MAC地址。

主机1发给主机5：

​	应用层：文件

​	传输层：报文段1，报文段2，报文段3

​	网络层：报文段1 IP1 IP5

​	数据链路层：报文段1 IP1 IP5 MAC1 （不知道IP5的MAC地址MAC5）

​	主机1与主机5相与操作，发现不是一个网段下，查找默认网关IP6（路由器端口）的地址

​	广播ARP请求分组：IP1 IP6 MAC1 FF-FF-FF-FF-FF-FF

​	单播ARP响应分组：IP6 MAC6

​	数据链路层：FCS 报文段1 IP1 IP5 MAC1 MAC6

​	物理层：模拟/数字信号

​	路由器解封装

​	网络层：IP1 IP5 MAC7 MAC8

​	路由器解封装

​	网络层：IP1 IP5 MAC9 MAC5

​	广播ARP请求分组：IP9 IP5 MAC9 FF-FF-FF-FF-FF-FF

​	单播ARP响应分组：IP5 MAC5

​	得到 报文段1 IP1 IP5 MAC9 MAC5