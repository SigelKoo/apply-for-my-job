# TCP长连接和短连接有那么不同的使用场景？

TCP在真正的读写操作之前，server与client之间必须建立一个连接，当读写操作完成后，双方不再需要这个连接时它们可以释放这个连接，连接的建立通过三次握手，释放则需要四次握手，所以说每个连接的建立都是需要资源消耗和时间消耗的。

### TCP短连接

模拟一种TCP短连接的情况：

1. client 向 server 发起连接请求
2. server 接到请求，双方建立连接
3. client 向 server 发送消息
4. server 回应 client
5. 一次读写完成，此时双方任何一个都可以发起 close 操作

在步骤5中，一般都是 client 先发起 close 操作。当然也不排除有特殊的情况。

从上面的描述看，短连接一般只会在 client/server 间传递一次读写操作

##### 短连接操作步骤

```
建立连接——数据传输——关闭连接
建立连接——数据传输——关闭连接
......
建立连接——数据传输——关闭连接
```

### TCP长连接

再模拟一种长连接的情况：

1. client 向 server 发起连接
2. server 接到请求，双方建立连接
3. client 向 server 发送消息
4. server 回应 client
5. 一次读写完成，连接不关闭
6. 后续读写操作...
7. 长时间操作之后client发起关闭请求

##### 长连接操作步骤

```
建立连接——数据传输...（保持连接）...数据传输——关闭连接
```

### 短连接与长连接优缺点

- 长连接优点：长连接可以省去较多的TCP建立和关闭的操作，减少浪费，节约时间。对于频繁请求资源的客户来说，较适用长连接。

- 长连接缺点：client与server之间的连接如果一直不关闭，随着客户端连接越来越多，server早晚有扛不住的时候，这时候server端需要采取一些策略，如关闭一些长时间没有读写事件发生的连接，这样可以避免一些恶意连接导致server端服务受损；如果条件再允许就可以以客户端机器为颗粒度，限制每个客户端的最大长连接数，这样可以完全避免客户端连累后端服务。

- 短连接优点：短连接对于服务器来说管理较为简单，存在的连接都是有用的连接，不需要额外的控制手段。

- 短连接缺点：但如果客户请求频繁，将在TCP的建立和关闭操作上浪费时间和带宽。