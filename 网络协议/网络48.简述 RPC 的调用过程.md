# 简述 RPC 的调用过程

### 调用过程

![img](https://img2018.cnblogs.com/blog/739231/201901/739231-20190113163552755-1990586909.png)

　　1. 调用者（客户端Client）以本地调用的方式发起调用；
　　2. Client stub（客户端存根）收到调用后，负责将被调用的方法名、参数等打包编码成特定格式的能进行网络传输的消息体；
　　3. Client stub将消息体通过网络发送给服务端；
　　4. Server stub（服务端存根）收到通过网络接收到消息后按照相应格式进行拆包解码，获取方法名和参数；
　　5. Server stub根据方法名和参数进行本地调用；
　　6. 被调用者（Server）本地调用执行后将结果返回给server stub；
　　7. Server stub将返回值打包编码成消息，并通过网络发送给客户端；
　　8. Client stub收到消息后，进行拆包解码，返回给Client；
　　9. Client得到本次RPC调用的最终结果。

### **消息协议**和**传输控制**的实现

1. RPC消息协议：客户端调用的参数和服务端的返回值这些在网络上传输的数据以何种方式打包编码和拆包解码，RPC的消息协议在设计时主要要考虑，消息转换及传输的效率，为解决消息转换及传输的效率，可以以二进制的方式传输消息，使用原始的二进制传输可以省去中间转换的环节并减少传输的数据量。
2. RPC传输控制：在TCP传输中客户端与服务端通过socket进行通信
![img](https://img2018.cnblogs.com/blog/739231/201901/739231-20190114102526621-478574471.png)