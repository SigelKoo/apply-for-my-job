# 简述什么是XSS攻击以及CSRF攻击？

### XSS攻击

XSS攻击全称跨站脚本攻击，是一种在web应用中的计算机安全漏洞，它允许恶意web用户将代码植入到提供给其它用户使用的页面中。

与SQL注入攻击类似，SQL注入攻击中以SQL语句作为用户输入，从而达到查询/修改/删除数据的目的，而在xss攻击中，通过插入恶意脚本，实现对用户浏览器的控制

##### XSS攻击有哪几种类型？

1. **反射型XSS攻击**

   反射型 XSS 一般是攻击者通过特定手法（如电子邮件），诱使用户去访问一个包含恶意代码的 URL，当受害者点击这些专门设计的链接的时候，恶意代码会直接在受害者主机上的浏览器执行。反射型XSS通常出现在网站的搜索栏、用户登录口等地方，常用来窃取客户端 Cookies 或进行钓鱼欺骗。

2. **存储型XSS攻击**

   也叫持久型XSS，主要将XSS代码提交存储在服务器端（数据库，内存，文件系统等），下次请求目标页面时不用再提交XSS代码。当目标用户访问该页面获取数据时，XSS代码会从服务器解析之后加载出来，返回到浏览器做正常的HTML和JS解析执行，XSS攻击就发生了。存储型 XSS 一般出现在网站留言、评论、博客日志等交互处，恶意脚本存储到客户端或者服务端的数据库中。

3. **DOM-based 型XSS攻击**

   基于 DOM 的 XSS 攻击是指通过恶意脚本修改页面的 DOM 结构，是纯粹发生在客户端的攻击。DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞。

##### 如何防御XSS攻击？

1. 对输入内容的特定字符进行编码，例如表示 html标记的 < > 等符号。
2. 对重要的 cookie设置 httpOnly，防止客户端通过document.cookie读取 cookie，此 HTTP头由服务端设置。
3. 将不可信的值输出 URL参数之前，进行 URLEncode操作，而对于从 URL参数中获取值一定要进行格式检测（比如你需要的时URL，就判读是否满足URL格式）。
4. 不要使用 Eval 来解析并运行不确定的数据或代码，对于 JSON解析请使用 JSON.parse() 方法。
5. 后端接口也应该要做到关键字符过滤的问题。

### CSRF攻击

Cross-site request forgery，跨站请求伪造。CSRF是一种冒充用户在当前已登录的Web应用程序上执行非本意的操作的攻击方法。实际上就是攻击者恶意利用用户信任的网站，构造了某些操作，引诱用户去点击，从而冒充用户，在其不知情的情况下完成攻击者想做的操作，比如以你的名义发消息、发邮件，盗取你的账号，添加系统管理员，甚至于购买商品、虚拟货币转账等。所以CSRF也被称为“One-Click Attack”（一键攻击）。

流程：

黑客给该明星的Gmail账户发了一封Email，邮件内容是一张图片，发送邮件中被植入了CSRF代码。

![CSRF攻击是什么？CSRF攻击原理及防御详解](https://www.idcbest.com/newsadmin/upFile/2019-12/2019122700013.jpg)

当用户点击邮件加载图片时，实际上访问了这样的链接：

```
https://mail.google.com/mail?ui=2&fw=true&fwe=attacker@email.com
```

这个链接的功能是设置Gmail邮件转发，因此目标邮箱中的所有邮件都被转发到黑客指定的邮箱。当这封邮件被打开时，攻击就悄悄地完成了，邮箱内所有邮件被转发到黑客的账号。

完成一次CSRF攻击，必须满足以下两个条件：

1. 用户登录受信任网站，并在本地生成Cookie（图中 步骤1-2）。

2. 在不登出该受信任网站的情况下，访问危险网站（图中 步骤3-4）。

##### 如何防御CSRF攻击

1. 验证HTTP请求头中指定字段
2. 添加校验Token