# 简述TCP的报文头部结构

#### TCP协议特点

1. TCP是面向连接的传输层协议。（面向连接-应用TCP时必须先建立好连接）
2. 每一条TCP连接只能有两个端点，每一条TCP连接只能是点对点的，不可广播。
3. TCP提供可靠交付的服务，无差错、不丢失、不重复、按序到达。（可靠有序，不丢不重）
4. TCP提供全双工通信。发送缓存保存了准备发送的数据和已发送但尚未收到确认的数据（保证超时后重发）；接收缓存保存了按序到达但尚未被接收应用程序读取的数据和不按序到达的数据。
5. TCP面向字节流。TCP把应用程序交下来的数据看成仅仅是一串的无结构的字节流。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200806105241382.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpYW90YWkxMjM0,size_16,color_FFFFFF,t_70#pic_center)

#### TCP报文段首部格式

![img](https://img-blog.csdnimg.cn/20200331162858401.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mjg1OTI4MA==,size_16,color_FFFFFF,t_70)

- 序号：在一个TCP连接中传送的字节流中的每一个字节都按顺序编号，本字段表示本报文段所发送数据的第一个字节的序号。（第一张图中发送123序号为1，下一个报文段序号为4）
- 确认号：期望收到对方下一个报文段的第一个数据字节的序号。若确认号为N，则证明到序号N-1为止的所有数据都已正确收到。
- 数据偏移（首部长度）：TCP报文段的数据起始处距离TCP报文段的起始处有多远，以4B位单位，即1个数值是4B。
- 6个控制位：
  
  - 紧急位URG：URG=1时， 标明此报文段中有紧急数据，是高优先级的数据，应尽快传送，不用在缓存里排队，配合紧急指针字段使用。
  - 确认位ACK：ACK=1时确认号有效，在连接建立后所有传送的报文段都必须把ACK置为1。
  - 推送位PSH：PSH=1时，接收方尽快交付接收应用进程，不再等到缓存填满再向上交付。
  - 复位RST：RST=1时，表明TCP连接中出现严重差错，必须释放连接，然后再重新建立传输链接。
  - 同步位SYN：SYN=1时，表明是一个连接请求/连接接受报文。
  - 终止位FIN：FIN=1时， 表明此报文段发送方数据已发完，要求释放连接。
- 窗口：指的是发送本报文段的一方的接收窗口，即现在允许对方发送的数据量。
- 检验和：检验首部+数据，检验时要加上12B伪首部，第四个字段传输层协议号为6（TCP为6，UDP为17）。

![image-20201229215044621](https://img-blog.csdnimg.cn/img_convert/858f417522a875cea30c06342624ee17.png)


- 紧急指针：URG=1时才有意义，指出本报文段中紧急数据的字节数。
- 选项：最大报文段长度MSS、窗口扩大、时间戳、选择确认.....
