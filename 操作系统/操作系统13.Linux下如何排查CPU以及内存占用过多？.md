# Linux下如何排查CPU以及内存占用过多？

1. 查看整体机器性能

   top命令

   ![top查看机器整体性能](https://img-blog.csdnimg.cn/20200124110753204.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTMwMjU2NDk=,size_16,color_FFFFFF,t_70)

   1.1 查看CPU
   1.2 查看MEM
   1.3 查看id=idle 机器空闲率，越高越好
   1.4 查看load average：系统负载。后面三个值，分别是系统1分钟，5分钟，15分钟的系统平均负载率。通过计算算出平均负载率。
   1.5 查看command

   top命令如何退出，使用q，这里不要使用ctrl+c强行中断退出。

   ![在这里插入图片描述](https://img-blog.csdnimg.cn/20200219212549296.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTMwMjU2NDk=,size_16,color_FFFFFF,t_70)

   看到一个叫做id=3928 名称为java的进程CPU占用高

2. ps -ef或者jps进一步定位，得知是一个怎么样的一个后台程序

3. 定位到具体线程或者代码

   ps -mp 进程 -o THREAD,tid,time

   ![在这里插入图片描述](https://img-blog.csdnimg.cn/20200219213027467.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTMwMjU2NDk=,size_16,color_FFFFFF,t_70)

   上图我们就可以根据进程查看到真正占用CPU资源就是id=3929的线程

4. 将需要的线程ID转换为16进制格式(英文小写格式) printf "%x\n" 有问题的线程ID或者使用计算器计算得到
   将id=3929 转换为十六进制f59

5. jstack 进程ID | grep tid(16进制线程ID小写英文) -A60

   jstack 3928 | grep F59 -A60（打印60行记录）

   ![在这里插入图片描述](https://img-blog.csdnimg.cn/20200219214228909.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTMwMjU2NDk=,size_16,color_FFFFFF,t_70)

   可以找到文件下的函数。