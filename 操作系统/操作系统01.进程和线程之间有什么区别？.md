# 进程和线程之间有什么区别？

#### 程序与进程

操作系统可以利用多核CPU同时运行多个任务，但使用单核CPU也可以执行多个任务。执行方式就是操作系统轮流让各个任务交替执行，例：任务1执行0.01秒，切换到任务2，任务2执行0.01秒，切换到任务3......反复交替执行，CPU执行较快，让用户感觉是在同时执行。

任务数量是远远大于CPU的核数，操作系统会将很多任务轮流调度到每个核上。

程序：是静态的，在磁盘中的可执行文件，是一系列的指令集合。

进程：是动态的，程序的一次执行过程。同一个程序多次执行会对应多个进程。

对于操作系统，一个任务就是一个进程，打开记事本即启动一个记事本进程，打开两个即启动两个。

#### 进程组成

- PCB（给操作系统用，保存进程管理相关数据）
- 程序段（程序代码）
- 数据段（运行过程中产生的各种数据，例如：程序中定义的变量）

#### PCB

PCB进程控制块是进程存在的唯一标志，当进程被创建时，操作系统为其创建PCB，当进程结束时，会回收其PCB。

PCB包括：
- 进程标识符PID
- 用户标识符UID
- 进程状态：运行态、就绪态、阻塞态、（新建态、终止态）
- CPU、磁盘、网络流量使用情况统计
- 正在使用哪些文件
- 正在使用哪些内存区域
- 正在使用哪些I/O设备
- 各种寄存器的值，用于实现进程切换

#### 线程

有些进程内部同时不止干一件事，word同时打字、拼写检查、打印等，就需要同时运行多个子任务。例：在网络或多用户交换机下，一个服务器通常需要接收大量不确定数量用户的并发请求，为每一个请求都创建一个进程显然行不通，每个子任务即线程。线程是最小的执行单元。

每个进程至少要干一件事，一个进程至少包含一个线程。多线程的执行方式和多进程是一样的，单核CPU由操作系统在多个线程之间快速反复交替执行，多核CPU由操作系统在多个线程间轮流调度到每个核上。

多任务的实现有3种方式

* 多进程模式

* 多线程模式：一个进程中包含多个线程

* 多进程+多线程模式

#### 进程与线程的区别

* 根本区别：进程是操作系统资源分配的基本单位，线程是处理器任务调度和执行的基本单位

* 资源开销：每个进程都有独立的代码和数据空间（程序上下文），程序之间的切换会有较大的开销；线程可以看做轻量级的进程，同一类线程共享本进程共享进程所拥有的全部资源，每个线程都有自己独立的运行栈、寄存器集合和程序计数器，线程之间切换的开销小，如果要求同时进行并且又要共享某些变量的并发操作，只能用线程不能用进程

* 包含关系：如果一个进程内有多个线程，执行过程是由多个线程共同完成的；线程是进程的一部分

* 内存分配：同一进程的线程共享本进程所拥有的全部资源，但进程间的地址空间和资源是相对独立的

* 影响关系：一个进程崩溃后，在保护模式下不会对其他进程产生影响；但是一个线程崩溃，整个进程都崩溃。多进程比多线程健壮

* 执行过程：每个独立的进程有程序运行的入口、顺序执行序列和程序出口。但是线程不能独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制，两者均可并发执行

操作系统給进程分配的资源包括 存放程序正文、数据的磁盘和内存地址空间，以及在运行时所需要的I/O设备，已打开的文件，信号量等

程序计数器是用于存放下一条指令所在单元的地址的地方。 当执行一条指令时，首先需要根据PC中存放的指令地址，将指令由内存取到指令寄存器中，此过程称为“取指令”。 