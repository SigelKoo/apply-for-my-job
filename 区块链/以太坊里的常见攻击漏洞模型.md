## 攻击

### P2P协议

#### 日蚀攻击

我们设想这样一个场景：如果一个节点接受的117个对内连接、对外发起的8个连接，其连接目标都是发起攻击的攻击者，那这是不是就意味着攻击者可以完全控制此节点所接受的信息了？事实就是如此，如果真的可以做到这一点，则攻击者就可以在被攻击节点和比特币网络中建立一个“中继”，使得此节点是能收到攻击者希望它能收到的信息。当发生此种情况时，我们称此节点被攻击者“日蚀”（Eclipse），这个词还是挺形象的~

假定攻击者可以将整个比特币网络划分为两个部分，左侧部分的节点总体拥有30%的算力，右侧部分的节点总体拥有30%的算力，而攻击者总体拥有40%的算力。如果攻击者可以让左右两侧的节点都接收不到相互之间的通信信息，则攻击者相当于与左侧节点建立了一个比特币子网络，而攻击者在这个子网络中拥有4/7的算力；反之，攻击者与右侧节点建立了另一个比特币子网络，攻击者在这个子网络中同样拥有4/7的算力。这样一来，攻击者虽然在全网只占有40%的算力，但在左/右两侧的子网络中却分别拥有50%以上的算力，从而实现51%攻击。

#### 路由攻击

从互联网路由的角度来看，比特币出呈现出了一定的中心化程度：20％的比特币节点托管在不到100个IP前缀中。 要知道，目前互联网上有近60万个IP前缀。 与此同时，大量比特币流量自然而然的经过若干成熟ISP（例如Hurricane Electric）。 这两方面综合在一起的话，大规模路由攻击的可能性极大上升。

分区攻击中，攻击者的目标是将比特币网络分成（至少）两个不相交的部分，之间不能交换任何信息（例如交易）。为将网络分隔成两个部分，比方说A、B，那么网络攻击者需要拦截发往A中所有比特币节点的全部流量，并中断与B的任何连接。

为拦截流量，网络攻击者需要依赖边界网关协议（BGP）中的漏洞。BGP是目前使用的唯一的互联网路由协议，对路由公告的来源并不进行验证。所以这种攻击常被称为BGP劫持，让路由器谎报到某些IP前缀有更好的路径。劫持A部分中与节点有关的所有IP前缀后，攻击者就可以有效地拦截A、B间交换的全部流量。一旦启动，攻击者就可以切断所有连接，进而断开A、B间的连接。

### 共识

#### PoW51%算力攻击

以太坊网络所有节点共同维护同一个账本，如果想要篡改账本中的数据必须能够控制全网大部分节点，即掌握51%的算力。

#### PoS51%攻击

想要篡改账本中的数据必须能够控制全网大部分节点，拥有50%以上的持币，但对这个币的攻击会导致币价下降，最大的损失者仍会是持币者本人。

#### DPos和DAG存在中心化风险

#### PoW自私挖矿

正常挖矿过程中，矿工挖到矿了都会立刻广播结果，生怕别人跟我来抢这个区块。但是在Selfish mining中则不然。假设目前所有矿工都工作在区块0上。这时攻击者首先发现新的区块（区块1），他会保留刚挖到的区块，把该区块当做自己的私有链，在私有链上继续挖下一个区块。假如攻击者又挖到了第二个区块（区块2），而这时其他矿工挖到了新区块（区块1'，因为没有听到区块1，还工作在区块0上），攻击者会直接提交两个区块。因为这时候0-1-2这条链长于0-1'这条链，0-1-2会被选做主链。因此，攻击者能获得2个区块的奖励，而别人的算力浪费了，无法获得奖励。

#### PoW坚强挖矿

算力更强的节点可以完全忽视剩下所有节点，从头开始挖，追赶上来。在领先、齐头并进、落后的情况下都“不轻易放弃”，连区块1的收益都不留给你。

#### PoS无利害攻击

攻击者分叉当前的链，对于持有币的”挖矿者“来讲，不需要去判断哪条链会获胜，最佳的策略是同时在两个分支上进行“挖矿”，因为最终无论哪个分支胜出，对于Staking的持币者来说都会获益，且过程不像PoW那样拼算力需要烧钱，PoS全程无消耗，所以对于持币的出块节点来说，同时在两个分支上挖矿完全可行。但这也就导致了，在某种情况下，恶意分叉某个PoS链，成功的可能性不小。一旦被攻击成功，一条链将可能分裂成多条链，将引发诸如：交易回滚、双花等一系列严重问题。

#### PoS长程攻击

攻击者创建了一条从创世区块开始的长区块链分支，并试图替换掉当前的合法主链。该分支上可能存有和主链不同的交易和区块。当用户可以不受制裁的进行分叉链的创建时，就有可能导致分叉链超过主链从而代替主链的地位。创建一条这样的链不需要投入矿机，没有耗能。

#### 区块截留攻击

区块截留攻击是恶意矿工始终选择将部分工作量证明发送给矿池管理者，一旦产生完整工作量证明时则将该证明直接抛弃。进行区块截留攻击的恶意矿工对被攻击的矿池不能产生任何有效帮助，并且还可以在矿池里获得一部分的收益。而对矿池管理者而言，虽然能够发现自身矿池正遭受到区块截留攻击，但无法判断矿池内的恶意矿工，因此无法及时采取措施来应对区块截留攻击。

假设你的算力为0.3，矿池A的算力为0.4，其他人的算力为0.3。自己正常挖矿，收益占总收益的0.3。但你讲算力分为两份，0.2和0.1，使用0.1在矿池A进行破坏，剩下0.2作为正常挖矿。0.1的破坏算力不提交新区块，系统总算力变为0.9。你的收益为2/9，矿池A为4/9，其他人为3/9。总收益=正常挖矿收益+矿池收益=2/9+4/9*1/(4+1)=14/45=0.31111>0.3

现在没有大规模爆发这种情况是因为矿工困境（囚徒困境），各大矿池心照不宣，大家都不干坏事，在全局最优点平衡。

#### FAW攻击

在区块截留攻击中，矿工会“扔掉”已发现的FPoW；在FAW中，攻击者会保留这个FPoW。当矿池外的其他矿工发现新的区块时，攻击者会提交之前发现的FPoW来造成分叉。其他情况下，攻击者和在区块截留攻击中一样，“扔掉”之前发现的FPoW。攻击者可以从分叉的情况获得收益（如果攻击者的分支被自己或者其他矿工扩展），而该情况下的BWH收益为0，所以攻击者的总收益高于BWH收益（其他情况下FAW和BWH收益相同）。FAW攻击的最坏情况，就是攻击者的分支始终不被选中作为主链，那么这种情况下，FAW会退化成BWH。

### 合约

浪子合约

交易资金因为漏洞返还给所有者、交易者过去发送给以太网的地址，以及特定地址。这种漏洞就像是空手套白狼，买家得到商品，而卖家无法得到加密货币。

贪婪合约

是指那些永远停留在以太坊的智能合约，如 Parity 漏洞正是一种贪婪合约，它会把智能合约所涉及的商品以及加密货币锁定在以太坊中，交易双方均无法得到，也不能取消。

自杀合约

智能合约的拥有者可以在以太坊发生故障时选择退回，类似于微信中的撤回选项。但是这个指令也可以被其他人执行，使得交易失败。

死后合约

在那些已完成或者被关闭的智能合约中，虽然他们的代码和全局变量被清除了，但是其中一部分仍然在继续执行。遗嘱合约和贪婪合约一样，均是由以太坊的错误引起，目前并不能被黑客利用。

