Layer 1 区块链具有更高的安全性和流动性，Layer 2 区块链则依赖 Layer 1 区块链为其提供安全性和流动性。

其实是将你的 100 Dai 发送到以太坊区块链上的另一个合约，也就是通常所说的 “存款” 合约

第一步：将 100 Dai 发送到Macau 在以太坊区块链上的存款合约。

第二步：你已经从 Macau 获得了 100 张借据（好比是赌场筹码）。凭这些借据，你可以取回你在以太坊上的存款合约中锁定的 Dai。我们称这些借据为合成 Dai（简称 sDai）。

第三步：将 Macau 上的 100 sDai 用于交易、流动性挖矿、投资等。

假设你玩德州，将 100 sDai 的本金翻倍变成了 200 sDai（这多出的 100 sDai 是你从对手那里赢来的，他们也在以太坊上的 Macau 存款合约中锁仓了一笔 Dai）。

考虑到安全性和流动性（或者不在乎那千把块美元的 gas 费），你想取回本息并放到以太坊上。如果你随时随地都能从 Macau 存款合约（再强调一次，这个合约在以太坊区块链上）中取回 200 Dai，且没人能阻止你（只有当满足这两个条件时），Macau 就是 Layer 2 区块链。

如果从理论上来说 Macau 的验证者可以阻止你取回 200 Dai，或直接偷走它们（自己取走），Macau 就不是 Layer 2 区块链，而是侧链。

如何将以太坊上的存款合约变得更加智能，来防止你、其他 Macau 用户以及 Macau 的矿工/验证者/运营方作弊呢？

可以想象得到，这并非一件容易的事，因为这需要存款合约能够实时了解 Macau 上的资金流向：假设 1 小时前你在 Macau 上玩德扑赢了 100 sDai，你就可以提取 100 Dai 到以太坊上，但是你可能在下一局就把这笔钱输掉了！因此，合约要能了解所有这些情况，以及 Macau 的最新状态。

状态通道和 plasma 等早期解决方案的做法是：将欺诈声明和争议解决逻辑编程到 Layer 1 上的存/取款合约中。但是，它们都给用户造成了沉重的负担，例如：

- 用户必须时刻在线监控以太坊上的 Layer 1 合约，以便挑战/制止/惩罚威胁其资产的恶意取款行为。

- 用户必须存储提出争议所必需的数据。在状态通道方案中，这个数据通常是对手方的签名，用来证明通道中的状态变化（例如，“Alice：我保证向 Bob 支付 10 Dai” 或 “Charlie：我保证将车移动到棋盘上的 H5” ）。

  如果是状态通道，根本没有什么 “Macau” 链，用户之间直接进行交互。例如，你在以太坊上质押了一笔 Dai，和一群小伙伴开了个状态通道打德扑，然后开始交换信息来更新游戏状态，如 “我弃牌，以这个密码学签名为证”。等游戏结束后，你可以向以太坊上的合约提交这局德州的最新快照，然后取出你的余额。支付通道和象棋通道也是同理。虽然状态通道方案可以消除来自恶意侧链运营者的风险，但是用户依然需要保持警惕，以防对手方试图使用已经过时的有效状态发起取款。因此，取款通常有一个等待期，以便其他参与者验证其有效性并发起挑战。例如，如果你要求取款并提交一个有效证明来证明你赢了，其他玩家可能会挑战你，利用你最近输给他们的游戏结果生存伪证明，并提交给合约。

- 只针对 plasma：用户容易受到两方面影响（a）需要存储的数据大量增加，因为用户所需数据是 plasma 链全局状态的一部分，而不只是状态通道的对手方的数据，（b）数据扣留攻击（data withholding attack），即，plasma 运营者（区块生产者）试图进行恶意取款，同时扣留用户发起挑战所需的数据。这进一步提高了 Layer 1 上取款安全性逻辑的复杂性。

  以 Plasma Cash 为例，用户会继承且必须存储其收到的每个代币的完整交易记录，这需要耗费大量时间。

直到 rollup 方案出现，才真正解决了这些棘手的问题。rollup 要求用户退出时所需的一切数据都能在 Layer 1 上获得。每当 Layer 2 上的状态变化时，rollup 运营者都会在 Layer-1 上披露导致本次状态变化的事务数据。因此，Layer 2上的执行和 Layer 1 上的数据更新是同步的。

rollup 方案通过数学方法（ZKRU）或密码学货币经济（ORU）保障来确保所有相关参与方都是诚实的。如果 rollup 运营者消失或开始捣乱【滥发信息、审查或（在 optimistic rollup 方案中）实施欺诈】，用户总是可以使用 Layer 1 上的数据来安全地取走资金。这些数据都存储在以太坊 Layer 1 上的 rollup 合约中，因此用户唯一需要信任的就是 Layer 1 会诚实地执行这些合约（其它 Layer 1 合约也采用同样的信任假设，如 MakerDao MCD 和 Aave 等）。

实际上，只需要一下午时间，你就可以构建出一条以太坊侧链：你只需要在以太坊上构建一个类似智能钱包的基础合约让人们能够存入资金，然后分叉 Geth（为你的侧链选一个新的链 ID 并重新构建即可）

rollup

https://ethfans.org/posts/almost-everything-you-need-to-know-about-optimistic-rollup-by-georgios

https://upyun-assets.ethfans.org/posts/optimistic-rollups-from-the-bottom



